/**
 * Cell Diagrams Renderer Styles
 * Updated for Cell-Based Architecture DSL
 */

/* ============================================
   CSS Variables
   ============================================ */

:root {
  --cell-color: #4f46e5;
  --cell-border-width: 2px;
}

/* ============================================
   Cell Diagram Container
   ============================================ */

.cell-diagram {
  width: 100%;
  height: 100%;
  min-height: 400px;
}

.cell-diagram-error {
  padding: 20px;
  background: #fef2f2;
  border: 1px solid #fecaca;
  border-radius: 8px;
  color: #dc2626;
}

.cell-diagram-error .error-title {
  font-weight: 600;
  margin-bottom: 10px;
}

.cell-diagram-error .error-list {
  margin: 0;
  padding-left: 20px;
  font-family: monospace;
  font-size: 14px;
}

/* ============================================
   Cell Node - Octagon Shape
   ============================================ */

.cell-node {
  background: white;
  min-width: 280px;
  box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
  overflow: hidden;
}

/* Octagon shape using clip-path */
.cell-node-octagon {
  clip-path: polygon(
    20px 0%,
    calc(100% - 20px) 0%,
    100% 20px,
    100% calc(100% - 20px),
    calc(100% - 20px) 100%,
    20px 100%,
    0% calc(100% - 20px),
    0% 20px
  );
  border: none;
  position: relative;
}

/* Octagon border via pseudo-element */
.cell-node-octagon::before {
  content: '';
  position: absolute;
  inset: 0;
  clip-path: polygon(
    20px 0%,
    calc(100% - 20px) 0%,
    100% 20px,
    100% calc(100% - 20px),
    calc(100% - 20px) 100%,
    20px 100%,
    0% calc(100% - 20px),
    0% 20px
  );
  background: var(--cell-color);
  z-index: -2;
}

.cell-node-octagon::after {
  content: '';
  position: absolute;
  inset: var(--cell-border-width);
  clip-path: polygon(
    calc(20px - var(--cell-border-width)) 0%,
    calc(100% - 20px + var(--cell-border-width)) 0%,
    100% calc(20px - var(--cell-border-width)),
    100% calc(100% - 20px + var(--cell-border-width)),
    calc(100% - 20px + var(--cell-border-width)) 100%,
    calc(20px - var(--cell-border-width)) 100%,
    0% calc(100% - 20px + var(--cell-border-width)),
    0% calc(20px - var(--cell-border-width))
  );
  background: white;
  z-index: -1;
}

.cell-node.selected {
  box-shadow: 0 0 0 3px var(--cell-color), 0 4px 6px -1px rgb(0 0 0 / 0.1);
}

.cell-node-header {
  padding: 10px 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: #f8fafc;
  border-bottom: 1px solid #e5e7eb;
}

.cell-node-title {
  font-weight: 600;
  font-size: 14px;
  color: #1f2937;
}

.cell-node-type-badge {
  font-size: 10px;
  color: white;
  padding: 3px 8px;
  border-radius: 4px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-weight: 500;
}

/* Section Labels */
.section-label {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: #6b7280;
  margin-bottom: 6px;
  font-weight: 600;
}

/* ============================================
   Gateway Section
   ============================================ */

.cell-gateway {
  padding: 10px 12px;
  background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
  border-bottom: 1px solid #bae6fd;
}

.gateway-header {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 13px;
  font-weight: 500;
  color: #0369a1;
}

.gateway-icon {
  font-size: 16px;
}

.gateway-id {
  flex: 1;
}

.gateway-auth-badge {
  cursor: help;
}

.gateway-exposes {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  margin-top: 6px;
}

.gateway-endpoint {
  font-size: 10px;
  padding: 2px 6px;
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.endpoint-api {
  background: #dbeafe;
  color: #1d4ed8;
}

.endpoint-events {
  background: #fef3c7;
  color: #b45309;
}

.endpoint-stream {
  background: #d1fae5;
  color: #047857;
}

.gateway-policies {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  margin-top: 6px;
}

.gateway-policy {
  font-size: 9px;
  padding: 2px 6px;
  background: #f3e8ff;
  color: #7c3aed;
  border-radius: 3px;
}

/* ============================================
   Components Section
   ============================================ */

.cell-node-components {
  padding: 10px 12px;
  border-bottom: 1px solid #e5e7eb;
}

.component-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 8px;
  background: #f3f4f6;
  border-radius: 4px;
  margin-bottom: 4px;
  font-size: 13px;
}

.component-item:last-child {
  margin-bottom: 0;
}

.component-icon {
  font-size: 14px;
  width: 20px;
  text-align: center;
}

.component-label {
  flex: 1;
  font-weight: 500;
  color: #1f2937;
}

.component-type-badge {
  font-size: 9px;
  color: #6b7280;
  background: #e5e7eb;
  padding: 2px 6px;
  border-radius: 3px;
  text-transform: uppercase;
}

/* Component Type Colors */
.component-microservice { border-left: 3px solid #4f46e5; }
.component-function { border-left: 3px solid #7c3aed; }
.component-database { border-left: 3px solid #059669; }
.component-broker { border-left: 3px solid #d97706; }
.component-cache { border-left: 3px solid #dc2626; }
.component-gateway { border-left: 3px solid #0891b2; }
.component-idp { border-left: 3px solid #be185d; }
.component-sts { border-left: 3px solid #f59e0b; }
.component-userstore { border-left: 3px solid #0d9488; }
.component-esb { border-left: 3px solid #2563eb; }
.component-adapter { border-left: 3px solid #8b5cf6; }
.component-transformer { border-left: 3px solid #ec4899; }
.component-webapp { border-left: 3px solid #06b6d4; }
.component-mobile { border-left: 3px solid #14b8a6; }
.component-iot { border-left: 3px solid #f43f5e; }
.component-legacy { border-left: 3px solid #78716c; }

/* Sidecars */
.component-sidecars {
  display: flex;
  gap: 3px;
  margin-top: 4px;
}

.sidecar-badge {
  font-size: 8px;
  padding: 1px 4px;
  background: #fef3c7;
  color: #92400e;
  border-radius: 2px;
}

/* ============================================
   Cluster Section
   ============================================ */

.cell-node-clusters {
  padding: 10px 12px;
  border-bottom: 1px solid #e5e7eb;
}

.cell-cluster {
  background: #fafafa;
  border: 1px dashed #d1d5db;
  border-radius: 6px;
  padding: 8px;
  margin-bottom: 8px;
}

.cell-cluster:last-child {
  margin-bottom: 0;
}

.cluster-header {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 12px;
  font-weight: 500;
  color: #374151;
  margin-bottom: 6px;
}

.cluster-icon {
  font-size: 14px;
}

.cluster-id {
  flex: 1;
}

.cluster-replicas {
  font-size: 10px;
  background: #dbeafe;
  color: #1d4ed8;
  padding: 2px 6px;
  border-radius: 3px;
  font-weight: 600;
}

.cluster-components .component-item {
  background: white;
}

/* ============================================
   Internal Connections Indicator
   ============================================ */

.cell-node-connections-indicator {
  padding: 6px 12px;
  background: #f9fafb;
  border-top: 1px solid #e5e7eb;
  text-align: center;
}

.connections-count {
  font-size: 10px;
  color: #6b7280;
}

/* Cell Handles */
.cell-handle {
  width: 12px !important;
  height: 12px !important;
  background: var(--cell-color, #4f46e5) !important;
  border: 2px solid white !important;
}

/* ============================================
   External Node
   ============================================ */

.external-node {
  background: white;
  border: 2px dashed #6b7280;
  border-radius: 12px;
  min-width: 120px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 4px rgb(0 0 0 / 0.1);
  padding: 12px;
}

.external-node.selected {
  border-style: solid;
  box-shadow: 0 0 0 2px #6b7280;
}

.external-saas { border-color: #0284c7; }
.external-partner { border-color: #059669; }
.external-enterprise { border-color: #7c3aed; }

.external-saas.selected { box-shadow: 0 0 0 2px #0284c7; }
.external-partner.selected { box-shadow: 0 0 0 2px #059669; }
.external-enterprise.selected { box-shadow: 0 0 0 2px #7c3aed; }

.external-node-icon {
  font-size: 28px;
  margin-bottom: 4px;
}

.external-node-label {
  font-size: 12px;
  font-weight: 500;
  text-align: center;
  color: #374151;
}

.external-node-type {
  font-size: 10px;
  color: #9ca3af;
  text-transform: uppercase;
  margin-top: 2px;
}

.external-node-provides {
  display: flex;
  gap: 4px;
  margin-top: 6px;
}

.provides-badge {
  font-size: 9px;
  padding: 2px 5px;
  border-radius: 3px;
  text-transform: uppercase;
}

.provides-api { background: #dbeafe; color: #1d4ed8; }
.provides-events { background: #fef3c7; color: #b45309; }
.provides-stream { background: #d1fae5; color: #047857; }

.external-handle {
  width: 10px !important;
  height: 10px !important;
  background: #6b7280 !important;
  border: 2px solid white !important;
}

/* ============================================
   User Node
   ============================================ */

.user-node {
  background: white;
  border: 2px solid #7c3aed;
  border-radius: 8px;
  min-width: 100px;
  padding: 12px;
  display: flex;
  flex-direction: column;
  align-items: center;
  box-shadow: 0 2px 4px rgb(0 0 0 / 0.1);
}

.user-node.selected {
  box-shadow: 0 0 0 2px #7c3aed;
}

.user-external { border-color: #7c3aed; }
.user-internal { border-color: #059669; }
.user-system { border-color: #6366f1; }

.user-external.selected { box-shadow: 0 0 0 2px #7c3aed; }
.user-internal.selected { box-shadow: 0 0 0 2px #059669; }
.user-system.selected { box-shadow: 0 0 0 2px #6366f1; }

.user-node-icon {
  font-size: 28px;
  margin-bottom: 4px;
}

.user-node-label {
  font-size: 12px;
  font-weight: 500;
  text-align: center;
  color: #374151;
}

.user-node-type {
  font-size: 10px;
  color: #9ca3af;
  text-transform: uppercase;
  margin-top: 2px;
}

.user-node-channels {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  margin-top: 6px;
  justify-content: center;
}

.channel-badge {
  font-size: 9px;
  padding: 2px 5px;
  background: #ede9fe;
  color: #7c3aed;
  border-radius: 3px;
}

.user-handle {
  width: 10px !important;
  height: 10px !important;
  background: #7c3aed !important;
  border: 2px solid white !important;
}

.user-internal .user-handle { background: #059669 !important; }
.user-system .user-handle { background: #6366f1 !important; }

/* ============================================
   Application Node
   ============================================ */

.application-node {
  background: white;
  border: 3px solid #6366f1;
  border-radius: 12px;
  min-width: 320px;
  box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
  overflow: hidden;
}

.application-node.selected {
  box-shadow: 0 0 0 3px #6366f1, 0 4px 6px -1px rgb(0 0 0 / 0.1);
}

.application-node-header {
  padding: 12px 16px;
  background: linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%);
  border-bottom: 1px solid #c7d2fe;
  display: flex;
  align-items: center;
  gap: 8px;
}

.application-icon {
  font-size: 18px;
}

.application-title {
  font-weight: 600;
  font-size: 15px;
  color: #1e1b4b;
  flex: 1;
}

.application-version {
  font-size: 11px;
  color: #6366f1;
  background: white;
  padding: 2px 8px;
  border-radius: 4px;
  font-weight: 500;
}

.application-gateway {
  padding: 10px 12px;
  background: #f0f9ff;
  border-bottom: 1px solid #bae6fd;
}

.application-cells {
  padding: 12px 16px;
}

.cells-list {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.cell-ref-badge {
  font-size: 11px;
  padding: 4px 10px;
  background: #f3f4f6;
  color: #374151;
  border-radius: 4px;
  border: 1px solid #e5e7eb;
  font-weight: 500;
}

.application-handle {
  width: 12px !important;
  height: 12px !important;
  background: #6366f1 !important;
  border: 2px solid white !important;
}

/* ============================================
   Connection Edge
   ============================================ */

.connection-edge {
  stroke: #94a3b8;
  stroke-width: 2;
}

.connection-edge.selected {
  stroke: #4f46e5;
  stroke-width: 3;
}

/* Direction-based colors */
.connection-edge.northbound { stroke: #22c55e; }
.connection-edge.southbound { stroke: #3b82f6; }
.connection-edge.eastbound { stroke: #f59e0b; }
.connection-edge.westbound { stroke: #8b5cf6; }

.connection-edge-label {
  background: white;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 11px;
  color: #374151;
  border: 1px solid #e5e7eb;
  box-shadow: 0 1px 2px rgb(0 0 0 / 0.05);
  white-space: nowrap;
}

/* Direction badges on edges */
.edge-direction-badge {
  font-size: 9px;
  padding: 2px 6px;
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 600;
}

.edge-direction-badge.northbound { background: #dcfce7; color: #166534; }
.edge-direction-badge.southbound { background: #dbeafe; color: #1e40af; }
.edge-direction-badge.eastbound { background: #fef3c7; color: #92400e; }
.edge-direction-badge.westbound { background: #f3e8ff; color: #6b21a8; }

/* ============================================
   React Flow Overrides
   ============================================ */

.react-flow__minimap {
  background: #f9fafb;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
}

.react-flow__controls {
  border-radius: 8px;
  border: 1px solid #e5e7eb;
  box-shadow: 0 2px 4px rgb(0 0 0 / 0.1);
}

.react-flow__controls-button {
  border-bottom: 1px solid #e5e7eb;
}

.react-flow__controls-button:last-child {
  border-bottom: none;
}

.react-flow__attribution {
  background: transparent !important;
}

.react-flow__attribution a {
  color: #9ca3af !important;
}
